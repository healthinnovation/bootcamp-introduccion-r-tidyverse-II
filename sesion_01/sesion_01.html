<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Introducción a R y Tidyverse II</title>
    <meta charset="utf-8" />
    <meta name="author" content="Laboratorio de Innovación en Salud" />
    <meta name="date" content="2022-09-29" />
    <script src="sesion_01_files/header-attrs/header-attrs.js"></script>
    <link href="sesion_01_files/tile-view/tile-view.css" rel="stylesheet" />
    <script src="sesion_01_files/tile-view/tile-view.js"></script>
    <script src="sesion_01_files/js-cookie/js.cookie.js"></script>
    <script src="sesion_01_files/peerjs/peerjs.min.js"></script>
    <script src="sesion_01_files/tiny.toast/toast.min.js"></script>
    <link href="sesion_01_files/xaringanExtra-broadcast/broadcast.css" rel="stylesheet" />
    <script src="sesion_01_files/xaringanExtra-broadcast/broadcast.js"></script>
    <script src="sesion_01_files/fabric/fabric.min.js"></script>
    <link href="sesion_01_files/xaringanExtra-scribble/scribble.css" rel="stylesheet" />
    <script src="sesion_01_files/xaringanExtra-scribble/scribble.js"></script>
    <script>document.addEventListener('DOMContentLoaded', function() { window.xeScribble = new Scribble({"pen_color":["#FF0000"],"pen_size":3,"eraser_size":30,"palette":[]}) })</script>
    <link href="sesion_01_files/panelset/panelset.css" rel="stylesheet" />
    <script src="sesion_01_files/panelset/panelset.js"></script>
    <script src="sesion_01_files/clipboard/clipboard.min.js"></script>
    <link href="sesion_01_files/xaringanExtra-clipboard/xaringanExtra-clipboard.css" rel="stylesheet" />
    <script src="sesion_01_files/xaringanExtra-clipboard/xaringanExtra-clipboard.js"></script>
    <script>window.xaringanExtraClipboard(null, {"button":"<i class=\"fa fa-clipboard\"><\/i>","success":"<i class=\"fa fa-check\" style=\"color: #90BE6D\"><\/i>","error":"<i class=\"fa fa-times-circle\" style=\"color: #F94144\"><\/i>"})</script>
    <link href="sesion_01_files/font-awesome/css/all.css" rel="stylesheet" />
    <link href="sesion_01_files/font-awesome/css/v4-shims.css" rel="stylesheet" />
    <link href="sesion_01_files/xaringanExtra-extra-styles/xaringanExtra-extra-styles.css" rel="stylesheet" />
    <script src="sesion_01_files/xaringanExtra-progressBar/progress-bar.js"></script>
    <meta name="github-repo" content="healthinnovation/bootcamp-introduccion-r-tidyverse-II"/>
    <meta name="twitter:title" content="Introducción a R y Tidyverse II Sesión 01"/>
    <meta name="twitter:description" content="Curso de Introducción a R y Tidyverse II: Sesión 01"/>
    <meta name="twitter:url" content="https://healthinnovation.github.io/bootcamp-introduccion-r-tidyverse-II/sesion_01/#1"/>
    <meta name="twitter:image" content="https://healthinnovation.github.io/xaringan-innovar/bootcamp-introduccion-r-tidyverse-II/sesion_01/img/cover-sesion01.png"/>
    <meta name="twitter:image:alt" content="Cover de la Sesión 01 del curso de Introducción a R y Tidyverse II"/>
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:creator" content="@innovalab_imt"/>
    <meta name="twitter:site" content="@innovalab_imt"/>
    <meta property="og:title" content="Introducción a R y Tidyverse II Sesión 01"/>
    <meta property="og:description" content="Curso de Introducción a R y Tidyverse II: Sesión 01"/>
    <meta property="og:url" content="https://healthinnovation.github.io/bootcamp-introduccion-r-tidyverse-II/sesion_01/#1"/>
    <meta property="og:image" content="https://healthinnovation.github.io/xaringan-innovar/bootcamp-introduccion-r-tidyverse-II/sesion_01/img/cover-sesion01.png"/>
    <meta property="og:image:alt" content="Cover de la Sesión 01 del curso de Introducción a R y Tidyverse II"/>
    <meta property="og:type" content="website"/>
    <meta property="og:locale" content="en_US"/>
    <meta property="article:author" content="Laboratorio de Innovación en Salud"/>
    <link href="sesion_01_files/countdown/countdown.css" rel="stylesheet" />
    <script src="sesion_01_files/countdown/countdown.js"></script>
    <link href="sesion_01_files/font-awesome-animation/font-awesome-animation-emi.css" rel="stylesheet" />
    <script src="sesion_01_files/fontawesome/js/fontawesome-all.min.js"></script>
    <link rel="stylesheet" href="xaringan-lis.css" type="text/css" />
    <link rel="stylesheet" href="custom.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
















<div>
<style type="text/css">.xaringan-extra-logo {
width: 100px;
height: 116px;
z-index: 0;
background-image: url(img/InnovaLab_logo_blue.png);
background-size: contain;
background-repeat: no-repeat;
position: absolute;
top:1em;right:1em;
}
</style>
<script>(function () {
  let tries = 0
  function addLogo () {
    if (typeof slideshow === 'undefined') {
      tries += 1
      if (tries < 10) {
        setTimeout(addLogo, 100)
      }
    } else {
      document.querySelectorAll('.remark-slide-content:not(.title-slide):not(.inverse):not(.hide_logo)')
        .forEach(function (slide) {
          const logo = document.createElement('div')
          logo.classList = 'xaringan-extra-logo'
          logo.href = null
          slide.appendChild(logo)
        })
    }
  }
  document.addEventListener('DOMContentLoaded', addLogo)
})()</script>
</div>



<style>.xe__progress-bar__container {
  bottom:0;
  opacity: 1;
  position:absolute;
  right:0;
  left: 0;
}
.xe__progress-bar {
  height: 0.25em;
  background-color: #0051BA;
  width: calc(var(--slide-current) / var(--slide-total) * 100%);
}
.remark-visible .xe__progress-bar {
  animation: xe__progress-bar__wipe 200ms forwards;
  animation-timing-function: cubic-bezier(.86,0,.07,1);
}
@keyframes xe__progress-bar__wipe {
  0% { width: calc(var(--slide-previous) / var(--slide-total) * 100%); }
  100% { width: calc(var(--slide-current) / var(--slide-total) * 100%); }
}</style>




&lt;br&gt;
&lt;br&gt;

# Introducción a R y Tidyverse II

## Sesión 01

## Laboratorio de Innovación en Salud  

### 2022-09-29

&lt;br&gt;

[<svg aria-hidden="true" role="img" viewBox="0 0 496 512" style="height:1em;width:0.97em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3 .3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5 .3-6.2 2.3zm44.2-1.7c-2.9 .7-4.9 2.6-4.6 4.9 .3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3 .7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3 .3 2.9 2.3 3.9 1.6 1 3.6 .7 4.3-.7 .7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3 .7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3 .7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> @healthinnovation](https://github.com/healthinnovation)  
[<svg aria-hidden="true" role="img" viewBox="0 0 512 512" style="height:1em;width:1em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M459.4 151.7c.325 4.548 .325 9.097 .325 13.65 0 138.7-105.6 298.6-298.6 298.6-59.45 0-114.7-17.22-161.1-47.11 8.447 .974 16.57 1.299 25.34 1.299 49.06 0 94.21-16.57 130.3-44.83-46.13-.975-84.79-31.19-98.11-72.77 6.498 .974 12.99 1.624 19.82 1.624 9.421 0 18.84-1.3 27.61-3.573-48.08-9.747-84.14-51.98-84.14-102.1v-1.299c13.97 7.797 30.21 12.67 47.43 13.32-28.26-18.84-46.78-51.01-46.78-87.39 0-19.49 5.197-37.36 14.29-52.95 51.65 63.67 129.3 105.3 216.4 109.8-1.624-7.797-2.599-15.92-2.599-24.04 0-57.83 46.78-104.9 104.9-104.9 30.21 0 57.5 12.67 76.67 33.14 23.72-4.548 46.46-13.32 66.6-25.34-7.798 24.37-24.37 44.83-46.13 57.83 21.12-2.273 41.58-8.122 60.43-16.24-14.29 20.79-32.16 39.31-52.63 54.25z"/></svg> @innovalab_imt](https://twitter.com/innovalab_imt)  
[<svg aria-hidden="true" role="img" viewBox="0 0 640 512" style="height:1em;width:1.25em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M172.5 131.1C228.1 75.51 320.5 75.51 376.1 131.1C426.1 181.1 433.5 260.8 392.4 318.3L391.3 319.9C381 334.2 361 337.6 346.7 327.3C332.3 317 328.9 297 339.2 282.7L340.3 281.1C363.2 249 359.6 205.1 331.7 177.2C300.3 145.8 249.2 145.8 217.7 177.2L105.5 289.5C73.99 320.1 73.99 372 105.5 403.5C133.3 431.4 177.3 435 209.3 412.1L210.9 410.1C225.3 400.7 245.3 404 255.5 418.4C265.8 432.8 262.5 452.8 248.1 463.1L246.5 464.2C188.1 505.3 110.2 498.7 60.21 448.8C3.741 392.3 3.741 300.7 60.21 244.3L172.5 131.1zM467.5 380C411 436.5 319.5 436.5 263 380C213 330 206.5 251.2 247.6 193.7L248.7 192.1C258.1 177.8 278.1 174.4 293.3 184.7C307.7 194.1 311.1 214.1 300.8 229.3L299.7 230.9C276.8 262.1 280.4 306.9 308.3 334.8C339.7 366.2 390.8 366.2 422.3 334.8L534.5 222.5C566 191 566 139.1 534.5 108.5C506.7 80.63 462.7 76.99 430.7 99.9L429.1 101C414.7 111.3 394.7 107.1 384.5 93.58C374.2 79.2 377.5 59.21 391.9 48.94L393.5 47.82C451 6.731 529.8 13.25 579.8 63.24C636.3 119.7 636.3 211.3 579.8 267.7L467.5 380z"/></svg> innovalab.info](https://www.innovalab.info/)  

---
## Contenidos

.line-space3-0[.font120[
- Categorización de variables con `case_when()`
- Algunas operaciones con manejo de texto (paquete `stringr`)
- Algunas operaciones con menejo de tiempo y horas (paquete `lubridate`)
- Cálculo de múltiples variables a la vez (`across()`)
- Operaciones por filas (`rowwise()`) y con múltiples variables (`c_across()`)
]]

---
class: center, middle, inverse

# Exploración competencial

---
## Importación de datos

.line-space1-7[.font110[Continuaremos usando la base de datos del ECA  sobre la [erradicación de la infección por *Helicobácter Pylori*](https://www.nature.com/articles/s41598-018-27482-2) explicado en la [sesión 02](https://healthinnovation.github.io/curso-introduccion-r-tidyverse/sesion_02/#14). Recordar siempre cargar tidyverse (`library()`)]]



.scroll-output350[

```r
trial_data &lt;- readxl::read_excel("data/researchdata.xlsx") %&gt;%
  janitor::clean_names() %&gt;%
  rename(
    follow_4_weeks = follow_up13c_ubt_4_weeks_after_therapy
  )
trial_data
```

```
## # A tibble: 400 × 10
##    patient_number baseli…¹ rando…² follo…³ adver…⁴ adver…⁵ adver…⁶ compl…⁷ uncom…⁸ per_p…⁹
##             &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  
##  1              1 Positive group B Negati… No      NA      NA      Yes     NA      Yes    
##  2              2 Positive group A Negati… Yes     Fatigue Mild    Yes     NA      Yes    
##  3              3 Positive group B Negati… No      NA      NA      Yes     NA      Yes    
##  4              4 Positive group A Positi… Yes     Abdomi… Mild    Yes     NA      Yes    
##  5              5 Positive group A Negati… Yes     Drowsi… Mild    Yes     NA      Yes    
##  6              6 Positive group A Negati… No      NA      NA      Yes     NA      Yes    
##  7              7 Positive group B Negati… No      NA      NA      Yes     NA      Yes    
##  8              8 Positive group A Negati… No      NA      NA      Yes     NA      Yes    
##  9              9 Positive group A Negati… No      NA      NA      Yes     NA      Yes    
## 10             10 Positive group A NA      NA      NA      NA      No      lost t… No     
## # … with 390 more rows, and abbreviated variable names ¹​baseline_13c_ubt,
## #   ²​randomized_group, ³​follow_4_weeks, ⁴​adverse_drug_reactions,
## #   ⁵​adverse_drug_reactions_content, ⁶​adverse_drug_reaction_classified,
## #   ⁷​complete_the_study, ⁸​uncompleted_reason, ⁹​per_protocol_analysis
```
]

---
## Categorización de variables

.line-space1-7[.font110[Para reemplazar respuestas dependiendo de una condición en particular se puede utilizar la función `case_when()` dentro de un `mutate()`]]

.code80[

```r
trial_data %&gt;% 
  mutate(
    Var = case_when(
      Var == "Text" ~ "New_Text", 
      TRUE ~ Var
    )
  )
```
]
.line-space1-7[.font110[De esta manera en la variable `Var` se reemplazará todos los casos que registren el dato de **Text** por **New_Text**.]]


---
## Uso de `mutate()` y `case_when()`

.panelset[
.panel[.panel-name[Explicación previa del NA]
.line-space1-5[
Al importar las bases de datos dentro de R, la gran mayoría de funciones (como `read_excel()`) interpretarán los valores en blanco o celdas vacías como reales `NA`. Sin embargo si en las celdas se ha llenado explícitamente el texto **NA** o se ha usado alguna codificación diferente, el valor de `NA` no se introducirá automáticamente y habrá que indicarlo como tal (`case_when()`).
]

.pull-left[
&lt;img src="img/view_excel_na.png" width="90%" style="display: block; margin: auto;" /&gt;
]

.pull-right[

```r
trial_data %&gt;% 
  count(adverse_drug_reactions)
```

```
## # A tibble: 4 × 2
##   adverse_drug_reactions     n
##   &lt;chr&gt;                  &lt;int&gt;
*## 1 NA                        10
## 2 No                       295
## 3 Yes                       94
*## 4 &lt;NA&gt;                       1
```
]]

.panel[.panel-name[Uso de case_when()]

La función `case_when()` tiene una aplicación directa y perfecta para estos fines, en el que recodificaremos el **NA** introducido como texto a un `NA` real que sea reconocido como tal. El mismo procedimiento se utilizaría si los valores faltantes o perdidos se hubieran codificado de otra forma (ej. `777` o `999`).

.pull-left[
Recordar que con **pipe** (` %&gt;% `) podemos anidar muchas funciones en un solo bloque:


```r
trial_data %&gt;%
  mutate(
    adverse_drug_reactions = case_when(
*     adverse_drug_reactions == "NA" ~ NA_character_,
      TRUE ~ adverse_drug_reactions
    )
  ) %&gt;% 
  count()
```
]

.pull-right[

El código `TRUE ~ adverse_drug_reactions` significa que **todos los demás casos** mantendrán el valor original que el de la variable.


```
## # A tibble: 3 × 2
##   adverse_drug_reactions     n
##   &lt;chr&gt;                  &lt;int&gt;
## 1 No                       295
## 2 Yes                       94
*## 3 &lt;NA&gt;                      11
```
]]

.panel[.panel-name[Advertencia]

La función `case_when` requiere respetar de forma estricta el tipo de vector utilizado. Es decir que si se le pide recodificar una variable a número, y dentro de esa variable continúan habiendo textos, habrá un problema de **no-coerción**. Es por ese motivo que en el anterior ejemplo se usa `NA_character` en vez de únicamente `NA`, ya que este elemento como tal en realidad es de tipo lógico.


```r
typeof(NA)
```

```
## [1] "logical"
```

```r
typeof(NA_character_)
```

```
## [1] "character"
```

```r
typeof(NA_real_)
```

```
## [1] "double"
```

]
.panel[.panel-name[Verificación]
.pull-left[

Recordar que todas las funciones que modifiquen variables pueden entrar dentro de un solo `mutate()`


```r
trial_data &lt;- trial_data %&gt;% 
  mutate(
    follow_4_weeks = case_when(
      follow_4_weeks == "NA" ~ NA_character_,
      TRUE ~ follow_4_weeks
    ),
    adverse_drug_reactions = case_when(
      adverse_drug_reactions == "NA" ~ NA_character_,
      TRUE ~ adverse_drug_reactions
    )
  )
```
]

.pull-right[

Ahora al ver el resultado de `count()`, veremos que solo hay un `NA` en el output, que es el reconocimiento real de valores faltantes.
.scroll-output300[

```r
trial_data %&gt;% 
  count(randomized_group, 
        follow_4_weeks,
        adverse_drug_reactions)
```

```
## # A tibble: 13 × 4
##    randomized_group follow_4_weeks adverse_drug_reactions     n
##    &lt;chr&gt;            &lt;chr&gt;          &lt;chr&gt;                  &lt;int&gt;
##  1 group A          Negative       No                       124
##  2 group A          Negative       Yes                       31
##  3 group A          Positive       No                        27
##  4 group A          Positive       Yes                       14
##  5 group A          &lt;NA&gt;           &lt;NA&gt;                       4
##  6 group B          Negative       No                       114
##  7 group B          Negative       Yes                       41
##  8 group B          Negative       &lt;NA&gt;                       4
##  9 group B          Positive       No                        25
## 10 group B          Positive       Yes                        8
## 11 group B          Positive       &lt;NA&gt;                       2
## 12 group B          &lt;NA&gt;           No                         5
## 13 group B          &lt;NA&gt;           &lt;NA&gt;                       1
```
]]]]

---
## Más sobre `case_when()`

Anteriormente vimos como usar la función `case_when` para recategorizar/recodificar variables en base a una condición de igualdad (`==`). Sin embargo, no es la única manera. También se puede recategorizar en base a múltiples condiciones, como `%in%` (comparar con múltiples valores a la vez), `&gt;`, `&gt;=`, `&lt;` y `&lt;=`, en conjunto con `&amp;` y `|`.

.pull-left[

Para ejemplificar esto haremos una recategorización de la base `nycflights13::flights`:

.scroll-output225[

```r
nycflights13::flights %&gt;% 
  count(year, month)
```

```
## # A tibble: 12 × 3
##     year month     n
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1  2013     1 27004
##  2  2013     2 24951
##  3  2013     3 28834
##  4  2013     4 28330
##  5  2013     5 28796
##  6  2013     6 28243
##  7  2013     7 29425
##  8  2013     8 29327
##  9  2013     9 27574
## 10  2013    10 28889
## 11  2013    11 27268
## 12  2013    12 28135
```
]]

.pull-right[
Consideraremos del mes 1 hasta el 6 como **2013-I** y a partir del mes 7, como **2013-II**. 

.scroll-output250[

```r
nycflights13::flights %&gt;% 
  mutate(
    year = case_when(
      month %in% 1:6 ~ "2013-I",
      TRUE ~ "2013-II"
    )
  ) %&gt;% 
  count(year)
```

```
## # A tibble: 2 × 2
##   year         n
##   &lt;chr&gt;    &lt;int&gt;
## 1 2013-I  166158
## 2 2013-II 170618
```
]]

---
## Más sobre `case_when()`

Ya que la variable `month` es de tipo `integer` (**numérica**) tenemos más formas alternativas de conseguir exactamente el mismo resultado mostrado anteriormente.

.pull-left[

En variables numéricas, podemos directamente usar `&lt;=` en las condiciones.


```r
nycflights13::flights %&gt;% 
  mutate(
    year = case_when(
      month &lt;= 6 ~ "2013-I",
      month &gt; 6 ~ "2013-II"
    )
  ) %&gt;% 
  count(year) 
```

```
## # A tibble: 2 × 2
##   year         n
##   &lt;chr&gt;    &lt;int&gt;
## 1 2013-I  166158
## 2 2013-II 170618
```
]

.pull-right[

O directamente usar `TRUE ~ "Condicion`, para *todos los demás casos*.


```r
nycflights13::flights %&gt;% 
  mutate(
    year = case_when(
      month &lt;= 6 ~ "2013-I",
      TRUE ~ "2013-II"
    )
  ) %&gt;% 
  count(year) 
```

```
## # A tibble: 2 × 2
##   year         n
##   &lt;chr&gt;    &lt;int&gt;
## 1 2013-I  166158
## 2 2013-II 170618
```
]

---

## ¡Hazlo tú mismo!

.line-space1-5[.font110[
Para este ejercicio usaremos la [ENDES 2020](https://minhaskamal.github.io/DownGit/#/home?url=https://github.com/healthinnovation/curso-introduccion-r-tidyverse/tree/main/sesion_04/data). Específicamente el módulo de cuestionario individual para mujeres de 12 a 49 años (`RECH94`). Sobre este módulo se requiere lo siguiente:

1. Importar el archivo `.sav` que se encuentra dentro de la carpeta `data/` en un objeto llamado `rech94`.
2. Usando el archivo PDF llamado `Diccionario - REC94.pdf` dentro de la carpeta `data/`, selecciona las siguientes variables: Identificador del cuestionario, meses de embarazo en última revisión prenatal, razón por la que no acudió a un hospital para dar a luz, prueba de anemia durante embarazo, diagnótico de anemia, tratamiento con hierro y consumo del mismo.
3. De forma similar con el archivo `RECH1.sav`, importarlo dentro de R.
4. Usando el documento `Diccionario - REC1.pdf`, filtrar únicamente los casos de mujeres que tengan edades entre los 12 y 49 años.
]]

<div class="countdown" id="timer_2de9f9fe" data-warn-when="60" data-update-every="1" tabindex="0" style="right:0;bottom:0;margin:0.5em;font-size:4em;">
<div class="countdown-controls"><button class="countdown-bump-down">&minus;</button><button class="countdown-bump-up">&plus;</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">10</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>
---

## Más sobre `mutate()` 

.pull-left[
.font90[
&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="img/mutate_ilustration.png" alt="Dibujo animado de lindos monstruos peludos vestidos como diferentes personajes de X-men, trabajando juntos para añadir una nueva columna a un dataframe existente. El texto del título estilizado dice &amp;quot;dplyr::mutate - añadir columnas, mantener las existentes.&amp;quot;" width="100%" /&gt;
&lt;p class="caption"&gt;Allison Horst, 2021. R &amp; stats illustrations&lt;/p&gt;
&lt;/div&gt;
]]

.pull-right[.line-space1-5[.font110[
Esta función del paquete `dplyr` nos permite agregar o modificar las variables actuales en un conjunto de datos (dataframe). 
Tal y como ya lo vimos, esta función puede hacer cambios sobre una o múltiples variables existentes, así como crear varias a la vez serparándolas con una coma [(Y. Wendy Huynh,2019)](https://bookdown.org/yih_huynh/Guide-to-R-Book/mutate.html).


```r
data %&gt;% 
  mutate(
    var1 = old_var*2,
    var2 = old_var*3,
    var3 = var1*var2
  )
```
]]]

---
## Múltiples variables: Uso de `across()`

.line-space1-7[.font110[Haremos la prueba con la base `storm`. Usando la función `across()` para aplicar una función a múltiples variables a la vez. En esta ocasión transformaremos en **factores** a las variables `status` y `category` de tormentas.]]

.pull-left[.scroll-output350[

```r
storms %&gt;% 
  select(name:pressure) %&gt;% 
  mutate(
    status = as.factor(status),
    category = as.factor(category)
  ) %&gt;% 
  glimpse()
```

```
## Rows: 11,859
## Columns: 11
## $ name     &lt;chr&gt; "Amy", "Amy", "Amy", "A…
## $ year     &lt;dbl&gt; 1975, 1975, 1975, 1975,…
## $ month    &lt;dbl&gt; 6, 6, 6, 6, 6, 6, 6, 6,…
## $ day      &lt;int&gt; 27, 27, 27, 27, 28, 28,…
## $ hour     &lt;dbl&gt; 0, 6, 12, 18, 0, 6, 12,…
## $ lat      &lt;dbl&gt; 27.5, 28.5, 29.5, 30.5,…
## $ long     &lt;dbl&gt; -79.0, -79.0, -79.0, -7…
## $ status   &lt;fct&gt; tropical depression, tr…
## $ category &lt;ord&gt; -1, -1, -1, -1, -1, -1,…
## $ wind     &lt;int&gt; 25, 25, 25, 25, 25, 25,…
## $ pressure &lt;int&gt; 1013, 1013, 1013, 1013,…
```
]]

.pull-left[.scroll-output350[

```r
storms %&gt;% 
  select(name:pressure) %&gt;% 
  mutate(
    across(c(status, category), as.factor)
  ) %&gt;% 
  glimpse()
```

```
## Rows: 11,859
## Columns: 11
## $ name     &lt;chr&gt; "Amy", "Amy", "Amy", "A…
## $ year     &lt;dbl&gt; 1975, 1975, 1975, 1975,…
## $ month    &lt;dbl&gt; 6, 6, 6, 6, 6, 6, 6, 6,…
## $ day      &lt;int&gt; 27, 27, 27, 27, 28, 28,…
## $ hour     &lt;dbl&gt; 0, 6, 12, 18, 0, 6, 12,…
## $ lat      &lt;dbl&gt; 27.5, 28.5, 29.5, 30.5,…
## $ long     &lt;dbl&gt; -79.0, -79.0, -79.0, -7…
## $ status   &lt;fct&gt; tropical depression, tr…
## $ category &lt;ord&gt; -1, -1, -1, -1, -1, -1,…
## $ wind     &lt;int&gt; 25, 25, 25, 25, 25, 25,…
## $ pressure &lt;int&gt; 1013, 1013, 1013, 1013,…
```
]]

---

## Operaciones por filas

.line-space1-7[.font110[En algunas ocasiones tenemos base de datos en el que se tiene múltiples variables sobre un mismo caso a través de columnas. Aunque pasarlos a un formato **tidy long** tal y como se encuentra la data `storms` es una buena idea, a veces es difícil cambiar el formato o se prefiere mantenerlo así. Veamos una ejemplificación modificando la data `gapminder` a un formato **wider**.]]

.pull-left[

```r
gapminder_wider &lt;- gapminder::gapminder %&gt;%
  pivot_wider(
    names_from = year,
    values_from = c(lifeExp:gdpPercap)
  )
```
]

.pull-right[.scroll-output325[

```
## # A tibble: 142 × 38
##    country    conti…¹ lifeE…² lifeE…³ lifeE…⁴
##    &lt;fct&gt;      &lt;fct&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
##  1 Afghanist… Asia       28.8    30.3    32.0
##  2 Albania    Europe     55.2    59.3    64.8
##  3 Algeria    Africa     43.1    45.7    48.3
##  4 Angola     Africa     30.0    32.0    34  
##  5 Argentina  Americ…    62.5    64.4    65.1
##  6 Australia  Oceania    69.1    70.3    70.9
##  7 Austria    Europe     66.8    67.5    69.5
##  8 Bahrain    Asia       50.9    53.8    56.9
##  9 Bangladesh Asia       37.5    39.3    41.2
## 10 Belgium    Europe     68      69.2    70.2
## # … with 132 more rows, 33 more variables:
## #   lifeExp_1967 &lt;dbl&gt;, lifeExp_1972 &lt;dbl&gt;,
## #   lifeExp_1977 &lt;dbl&gt;, lifeExp_1982 &lt;dbl&gt;,
## #   lifeExp_1987 &lt;dbl&gt;, lifeExp_1992 &lt;dbl&gt;,
## #   lifeExp_1997 &lt;dbl&gt;, lifeExp_2002 &lt;dbl&gt;,
## #   lifeExp_2007 &lt;dbl&gt;, pop_1952 &lt;int&gt;,
## #   pop_1957 &lt;int&gt;, pop_1962 &lt;int&gt;, …
```
]]

---
## Uso de `rowwise()`

.line-space1-7[.font110[Hagamos una prueba con con `gapminder_wider` para obtener el promedio de la esperanza de vida de sus 3 primeros registros anuales disponibles:]]

.pull-left[

```r
gapminder_wider %&gt;%
  rowwise() %&gt;%
  mutate(
    avg_lifeExp_52_62 = mean(c(
      lifeExp_1952,
      lifeExp_1957,
      lifeExp_1962
    )),
    .after = "continent"
  )
```
]

.pull-left[.scroll-output350[

```
## # A tibble: 142 × 39
## # Rowwise: 
##    country conti…¹ avg_l…² lifeE…³ lifeE…⁴
##    &lt;fct&gt;   &lt;fct&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
##  1 Afghan… Asia       30.4    28.8    30.3
##  2 Albania Europe     59.8    55.2    59.3
##  3 Algeria Africa     45.7    43.1    45.7
##  4 Angola  Africa     32.0    30.0    32.0
##  5 Argent… Americ…    64.0    62.5    64.4
##  6 Austra… Oceania    70.1    69.1    70.3
##  7 Austria Europe     67.9    66.8    67.5
##  8 Bahrain Asia       53.9    50.9    53.8
##  9 Bangla… Asia       39.3    37.5    39.3
## 10 Belgium Europe     69.2    68      69.2
## # … with 132 more rows, 34 more
## #   variables: lifeExp_1962 &lt;dbl&gt;,
## #   lifeExp_1967 &lt;dbl&gt;,
## #   lifeExp_1972 &lt;dbl&gt;,
## #   lifeExp_1977 &lt;dbl&gt;,
## #   lifeExp_1982 &lt;dbl&gt;,
## #   lifeExp_1987 &lt;dbl&gt;, …
```
]]

---
## Uso de `c_across()`

El uso de `c()` podría ser suficiente para algunos casos, pero es muy limitante... si quisieramos seleccionar bloques de columnas (`var1:var100`) o usar alguna función `tidyselect` como por ejemplo `starts_with()`, simplemente no podríamos. Para ello emplearemos `c_across()` en "reemplazo". Por ejemplo, para obtener el promedio de esperanza de vida de todos los años registrados.

.scroll-output300[

```r
gapminder_wider %&gt;%
  rowwise() %&gt;%
  mutate(
    avg_lifeExp = mean(c_across(starts_with("lifeExp"))),
    .after = "continent"
  )
```

```
## # A tibble: 142 × 39
## # Rowwise: 
##    country     continent avg_l…¹ lifeE…² lifeE…³ lifeE…⁴ lifeE…⁵ lifeE…⁶ lifeE…⁷
##    &lt;fct&gt;       &lt;fct&gt;       &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
##  1 Afghanistan Asia         37.5    28.8    30.3    32.0    34.0    36.1    38.4
##  2 Albania     Europe       68.4    55.2    59.3    64.8    66.2    67.7    68.9
##  3 Algeria     Africa       59.0    43.1    45.7    48.3    51.4    54.5    58.0
##  4 Angola      Africa       37.9    30.0    32.0    34      36.0    37.9    39.5
##  5 Argentina   Americas     69.1    62.5    64.4    65.1    65.6    67.1    68.5
##  6 Australia   Oceania      74.7    69.1    70.3    70.9    71.1    71.9    73.5
##  7 Austria     Europe       73.1    66.8    67.5    69.5    70.1    70.6    72.2
##  8 Bahrain     Asia         65.6    50.9    53.8    56.9    59.9    63.3    65.6
##  9 Bangladesh  Asia         49.8    37.5    39.3    41.2    43.5    45.3    46.9
## 10 Belgium     Europe       73.6    68      69.2    70.2    70.9    71.4    72.8
## # … with 132 more rows, 30 more variables: lifeExp_1982 &lt;dbl&gt;,
## #   lifeExp_1987 &lt;dbl&gt;, lifeExp_1992 &lt;dbl&gt;, lifeExp_1997 &lt;dbl&gt;,
## #   lifeExp_2002 &lt;dbl&gt;, lifeExp_2007 &lt;dbl&gt;, pop_1952 &lt;int&gt;, pop_1957 &lt;int&gt;,
## #   pop_1962 &lt;int&gt;, pop_1967 &lt;int&gt;, pop_1972 &lt;int&gt;, pop_1977 &lt;int&gt;,
## #   pop_1982 &lt;int&gt;, pop_1987 &lt;int&gt;, pop_1992 &lt;int&gt;, pop_1997 &lt;int&gt;,
## #   pop_2002 &lt;int&gt;, pop_2007 &lt;int&gt;, gdpPercap_1952 &lt;dbl&gt;, gdpPercap_1957 &lt;dbl&gt;,
## #   gdpPercap_1962 &lt;dbl&gt;, gdpPercap_1967 &lt;dbl&gt;, gdpPercap_1972 &lt;dbl&gt;, …
```
]

---


count: false
 
## Operación con fechas: lubridate 
.line-space1-5[.font110[Muchas veces durante el pre-procesamiento de datos tenemos que enfrentarnos a manejo de fechas (crear, transformar, etc.). Para estos fines podemos usar [las funciones del paquete `lubridate`](https://r4ds.had.co.nz/dates-and-times.html). 

Para tener una mejor apreciación de la variable de fecha que crearemos, usaremos `relocate()` para reposicionar a la variable creada.]]
.panel1-mutate_lubr_1-user[

```r
*storms %&gt;%
* select(name:pressure)
```
]
 
.panel2-mutate_lubr_1-user[

```
## # A tibble: 11,859 × 11
##    name   year month   day  hour   lat  long status    
##    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     
##  1 Amy    1975     6    27     0  27.5 -79   tropical …
##  2 Amy    1975     6    27     6  28.5 -79   tropical …
##  3 Amy    1975     6    27    12  29.5 -79   tropical …
##  4 Amy    1975     6    27    18  30.5 -79   tropical …
##  5 Amy    1975     6    28     0  31.5 -78.8 tropical …
##  6 Amy    1975     6    28     6  32.4 -78.7 tropical …
##  7 Amy    1975     6    28    12  33.3 -78   tropical …
##  8 Amy    1975     6    28    18  34   -77   tropical …
##  9 Amy    1975     6    29     0  34.4 -75.8 tropical …
## 10 Amy    1975     6    29     6  34   -74.8 tropical …
## # … with 11,849 more rows, and 3 more variables:
## #   category &lt;ord&gt;, wind &lt;int&gt;, pressure &lt;int&gt;
```
]

---
count: false
 
## Operación con fechas: lubridate 
.line-space1-5[.font110[Muchas veces durante el pre-procesamiento de datos tenemos que enfrentarnos a manejo de fechas (crear, transformar, etc.). Para estos fines podemos usar [las funciones del paquete `lubridate`](https://r4ds.had.co.nz/dates-and-times.html). 

Para tener una mejor apreciación de la variable de fecha que crearemos, usaremos `relocate()` para reposicionar a la variable creada.]]
.panel1-mutate_lubr_1-user[

```r
storms %&gt;%
  select(name:pressure) %&gt;%
* mutate(
*   date = lubridate::make_date(year, month, day)
* )
```
]
 
.panel2-mutate_lubr_1-user[

```
## # A tibble: 11,859 × 12
##    name   year month   day  hour   lat  long status    
##    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     
##  1 Amy    1975     6    27     0  27.5 -79   tropical …
##  2 Amy    1975     6    27     6  28.5 -79   tropical …
##  3 Amy    1975     6    27    12  29.5 -79   tropical …
##  4 Amy    1975     6    27    18  30.5 -79   tropical …
##  5 Amy    1975     6    28     0  31.5 -78.8 tropical …
##  6 Amy    1975     6    28     6  32.4 -78.7 tropical …
##  7 Amy    1975     6    28    12  33.3 -78   tropical …
##  8 Amy    1975     6    28    18  34   -77   tropical …
##  9 Amy    1975     6    29     0  34.4 -75.8 tropical …
## 10 Amy    1975     6    29     6  34   -74.8 tropical …
## # … with 11,849 more rows, and 4 more variables:
## #   category &lt;ord&gt;, wind &lt;int&gt;, pressure &lt;int&gt;,
## #   date &lt;date&gt;
```
]

---
count: false
 
## Operación con fechas: lubridate 
.line-space1-5[.font110[Muchas veces durante el pre-procesamiento de datos tenemos que enfrentarnos a manejo de fechas (crear, transformar, etc.). Para estos fines podemos usar [las funciones del paquete `lubridate`](https://r4ds.had.co.nz/dates-and-times.html). 

Para tener una mejor apreciación de la variable de fecha que crearemos, usaremos `relocate()` para reposicionar a la variable creada.]]
.panel1-mutate_lubr_1-user[

```r
storms %&gt;%
  select(name:pressure) %&gt;%
  mutate(
    date = lubridate::make_date(year, month, day)
  ) %&gt;%
* relocate(date, .before = year)
```
]
 
.panel2-mutate_lubr_1-user[

```
## # A tibble: 11,859 × 12
##    name  date        year month   day  hour   lat  long
##    &lt;chr&gt; &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 Amy   1975-06-27  1975     6    27     0  27.5 -79  
##  2 Amy   1975-06-27  1975     6    27     6  28.5 -79  
##  3 Amy   1975-06-27  1975     6    27    12  29.5 -79  
##  4 Amy   1975-06-27  1975     6    27    18  30.5 -79  
##  5 Amy   1975-06-28  1975     6    28     0  31.5 -78.8
##  6 Amy   1975-06-28  1975     6    28     6  32.4 -78.7
##  7 Amy   1975-06-28  1975     6    28    12  33.3 -78  
##  8 Amy   1975-06-28  1975     6    28    18  34   -77  
##  9 Amy   1975-06-29  1975     6    29     0  34.4 -75.8
## 10 Amy   1975-06-29  1975     6    29     6  34   -74.8
## # … with 11,849 more rows, and 4 more variables:
## #   status &lt;chr&gt;, category &lt;ord&gt;, wind &lt;int&gt;,
## #   pressure &lt;int&gt;
```
]

&lt;style&gt;
.panel1-mutate_lubr_1-user {
  color: black;
  width: 38.6060606060606%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-mutate_lubr_1-user {
  color: black;
  width: 59.3939393939394%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-mutate_lubr_1-user {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;






&lt;style type="text/css"&gt;
.panel2-mutate_lubr_1-user {
    height: 275px;
    overflow-y: auto !important;
}
&lt;/style&gt;

---
class: center, middle

# Retroalimentación


---
class: center, middle

&lt;br&gt;
&lt;center&gt;
&lt;h2&gt;
&lt;span style="color:#106075"&gt;¡Gracias!&lt;/span&gt;
&lt;/h2&gt;
&lt;br&gt;
&lt;h3&gt;
<span>&lt;i class="fas  fa-envelope fa-xs faa-float animated "&gt;&lt;/i&gt;&lt;a href="mailto:imt.innovlab@oficinas-upch.pe"&gt;&lt;span style="color:#562457"&gt;&amp;nbsp;&amp;nbsp;imt.innovlab@oficinas-upch.pe&lt;/span&gt;&lt;/a&gt;</span>
&lt;/h3&gt;
&lt;h3&gt;
<span>&lt;i class="fab  fa-github fa-xs faa-float animated "&gt;&lt;/i&gt;&lt;a href="https://github.com/healthinnovation/"&gt;&lt;span style="color:#562457"&gt;&amp;nbsp;&amp;nbsp; @healthinnovation&lt;/span&gt;&lt;/a&gt;</span>
&lt;/h3&gt;
&lt;h3&gt;
<span>&lt;i class="fab  fa-twitter fa-xs faa-float animated "&gt;&lt;/i&gt;&lt;a href="https://twitter.com/innovalab_imt"&gt;&lt;span style="color:#562457"&gt;&amp;nbsp;&amp;nbsp; @innovalab_imt&lt;/span&gt;&lt;/a&gt;</span>
&lt;/h3&gt;
&lt;/center&gt;

&lt;br&gt;

Estas diapositivas fueron creadas mediante el paquete [xaringan](https://github.com/yihui/xaringan) y [xaringanthemer](https://github.com/gadenbuie/xaringanthemer/).



    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"slideNumberFormat": "%current%/%total%",
"highlightStyle": "idea",
"highlightLines": true,
"ratio": "16:9",
"countIncrementalSlides": true
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
